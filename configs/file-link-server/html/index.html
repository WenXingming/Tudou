<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FileShare</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* ç™½å¤©æ¨¡å¼ */
            --light-bg-gradient-start: #e0e7ff;
            --light-bg-gradient-end: #f3e8ff;
            --bg-gradient-start: #e0e7ff;
            --bg-gradient-end: #f3e8ff;
            --card-bg: rgba(255, 255, 255, 0.85);
            --card-border: rgba(255, 255, 255, 0.6);
            --card-inner-highlight: rgba(255, 255, 255, 0);
            --card-inner-shadow: rgba(0, 0, 0, 0);
            --text-main: #1f2937;
            --text-secondary: #6b7280;
            --primary-color: #4f46e5;
            --primary-hover: #4338ca;
            --border-color: #e5e7eb;
            --upload-area-bg: rgba(255, 255, 255, 0.5);
            --upload-area-hover: rgba(255, 255, 255, 0.8);
            --success-color: #10b981;
            --error-color: #ef4444;
            --shadow-color: rgba(0, 0, 0, 0.1);

            --toggle-bg: rgba(255, 255, 255, 0.75);
            --toggle-border: rgba(229, 231, 235, 0.9);

            --result-bg: #ecfdf5;
            --result-border: #d1fae5;
            --link-container-bg: #ffffff;
            --link-container-border: #a7f3d0;

            --surface-bg: #ffffff;
            --surface-hover: #f3f4f6;
            --surface-border-hover: #d1d5db;

            --danger-bg: #fef2f2;
            --danger-border: #fecaca;

            /* å¡ç‰‡æ¨¡ç³Šï¼šé»˜è®¤ï¼ˆç™½å¤©ï¼‰ä¿ç•™ç»ç’ƒè´¨æ„Ÿ */
            --card-backdrop: blur(16px);

            /* ç™»å½•å¼¹çª—ï¼šé»˜è®¤è·Ÿéšå¡ç‰‡èƒŒæ™¯ */
            --auth-modal-bg: var(--card-bg);
        }

        [data-theme="dark"] {
            /* é»‘å¤œæ¨¡å¼ */
            --dark-bg-gradient-start: #667eea;
            --dark-bg-gradient-end: #764ba2;
            --bg-gradient-start: var(--dark-bg-gradient-start);
            --bg-gradient-end: var(--dark-bg-gradient-end);

            /* å¤œé—´å¡ç‰‡ï¼šå®ä½“æ·±è‰²é¢æ¿ + è½»å¾®ç´«è°ƒï¼Œå’ŒèƒŒæ™¯ç´«è‰²æ¸å˜æ›´åè°ƒ */
            /* é¢æ¿æ›´åâ€œæ·¡ç´«â€ï¼Œä¸”ä¸‹åŠä¸è¦å¤ªé»‘ */
            --card-bg: linear-gradient(180deg,
                    rgba(0, 0, 0, 0.7),
                    rgba(0, 0, 0, 0.75));

            /* å¤œé—´ç™»å½•å¼¹çª—èƒŒæ™¯ï¼šç¨å¾®æ›´æ·±ä¸€ç‚¹ï¼Œçªå‡ºå¼¹çª—å±‚çº§ */
            --auth-modal-bg: linear-gradient(180deg,
                    rgba(0, 0, 0, 0.9),
                    rgba(0, 0, 0, 0.95));
            --card-border: rgba(221, 214, 254, 0.20);
            --card-inner-highlight: rgba(255, 255, 255, 0.06);
            --card-inner-shadow: rgba(17, 24, 39, 0.52);

            --text-main: rgba(249, 250, 251, 0.95);
            --text-secondary: rgba(229, 231, 235, 0.80);

            --primary-color: #8b5cf6;
            --primary-hover: #7c3aed;

            --border-color: rgba(255, 255, 255, 0.14);
            --upload-area-bg: rgba(31, 41, 55, 0.28);
            --upload-area-hover: rgba(31, 41, 55, 0.42);
            /* é¢æ¿é˜´å½±ï¼šç•¥å¸¦æ·±ç´«æ°›å›´å…‰ï¼Œé¿å…ä¸èƒŒæ™¯å‰²è£‚ */
            --shadow-color: rgba(88, 28, 135, 0.22);

            /* åˆ‡æ¢æŒ‰é’®åœ¨å¤œé—´ä¹Ÿè¦å˜æ·±è‰²ï¼Œè€Œä¸æ˜¯ä¸€ç›´ç™½ */
            --toggle-bg: rgba(17, 24, 39, 0.6);
            --toggle-border: rgba(255, 255, 255, 0.18);

            /* ç»“æœåŒºåŸŸä¸é“¾æ¥å®¹å™¨é¿å…åœ¨å¤œé—´è¿‡äº® */
            --result-bg: rgba(16, 185, 129, 0.12);
            --result-border: rgba(16, 185, 129, 0.22);
            --link-container-bg: rgba(17, 24, 39, 0.55);
            --link-container-border: rgba(16, 185, 129, 0.28);

            --surface-bg: rgba(17, 24, 39, 0.6);
            --surface-hover: rgba(31, 41, 55, 0.55);
            --surface-border-hover: rgba(255, 255, 255, 0.22);

            --danger-bg: rgba(239, 68, 68, 0.12);
            --danger-border: rgba(239, 68, 68, 0.25);

            /* ä»ç„¶æ˜¯å®ä½“é¢æ¿ï¼Œä½†ä¿ç•™è½»å¾®æŸ”åŒ–ï¼Œè®©é¢æ¿æ›´èå…¥èƒŒæ™¯æ¸å˜ */
            --card-backdrop: blur(6px) saturate(120%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* å…¨å±€è¿‡æ¸¡æ•ˆæœï¼Œå®ç°ä¸æ»‘åˆ‡æ¢ */
        body,
        .container,
        .upload-area,
        .file-info,
        .upload-action-btn,
        .cancel-btn,
        .theme-toggle {
            transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                border-color 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                color 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                background-image 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ä¸»é¢˜åˆ‡æ¢é®ç½©ï¼šæ ¹æ®åˆ‡æ¢æ–¹å‘ä»è§’è½â€œæ­å¼€â€ */
        .theme-transition-layer {
            position: fixed;
            inset: 0;
            z-index: 2000;
            pointer-events: none;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            will-change: clip-path;
            clip-path: circle(150vmax at 0 0);
            transition: clip-path 1.5s cubic-bezier(0.22, 1, 0.36, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start), var(--bg-gradient-end));
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: var(--text-main);
        }

        .container {
            background: var(--card-bg);
            backdrop-filter: var(--card-backdrop);
            border-radius: 24px;
            box-shadow:
                0 25px 50px -12px var(--shadow-color),
                inset 0 1px 0 var(--card-inner-highlight),
                inset 0 -1px 0 var(--card-inner-shadow);
            padding: 48px;
            width: 100%;
            max-width: 540px;
            text-align: center;
            border: 1px solid var(--card-border);
            position: relative;
        }

        /* åˆ‡æ¢æŒ‰é’®æ ·å¼ï¼šå›ºå®šåœ¨å³ä¸Šè§’ï¼Œä½¿ç”¨ SVG å›¾æ ‡ */
        .theme-toggle {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 1px solid var(--toggle-border);
            background: var(--toggle-bg);
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(8px);
        }

        /* Auth button: sits left to theme toggle */
        .auth-toggle {
            position: fixed;
            top: 24px;
            right: 84px;
            z-index: 1000;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 1px solid var(--toggle-border);
            background: var(--toggle-bg);
            color: var(--text-main);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(8px);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .auth-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .auth-toggle svg {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* Auth modal */
        .auth-overlay {
            position: fixed;
            inset: 0;
            z-index: 1500;
            background: rgba(0, 0, 0, 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.25s ease;
        }

        .auth-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .auth-modal {
            position: relative;
            width: min(520px, calc(100vw - 32px));
            border-radius: 18px;
            border: 1px solid var(--card-border);
            background: var(--auth-modal-bg);
            backdrop-filter: var(--card-backdrop);
            box-shadow:
                0 25px 50px -12px var(--shadow-color),
                inset 0 1px 0 var(--card-inner-highlight),
                inset 0 -1px 0 var(--card-inner-shadow);
            transform: translateY(10px) scale(0.98);
            transition: transform 0.25s ease;
            padding: 18px;
            overflow: hidden;
        }

        .auth-modal::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 18px;
            pointer-events: none;
            z-index: 0;
            background: radial-gradient(800px 200px at 20% 0%, rgba(255, 255, 255, 0.12), transparent 60%),
                radial-gradient(500px 200px at 90% 30%, rgba(124, 58, 237, 0.18), transparent 60%);
            opacity: 0.85;
        }

        .auth-overlay.show .auth-modal {
            transform: translateY(0) scale(1);
        }

        .auth-modal-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .auth-modal-title {
            font-weight: 800;
            letter-spacing: -0.01em;
        }

        .auth-modal-subtitle {
            margin-top: 4px;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .auth-body {
            position: relative;
            z-index: 1;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .theme-toggle svg {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .logo {
            font-size: 2.25rem;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, var(--primary-color), #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.025em;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-bottom: 40px;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 16px;
            padding: 48px 24px;
            margin-bottom: 24px;
            cursor: pointer;
            background: var(--upload-area-bg);
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: var(--upload-area-hover);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background: var(--upload-area-hover);
            transform: scale(1.02);
        }

        .upload-area.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        .upload-icon {
            font-size: 3.5rem;
            color: var(--primary-color);
            margin-bottom: 16px;
            transition: transform 0.3s ease;
        }

        .login-area {
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.14);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 0;
            text-align: left;
        }

        .login-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-main);
        }

        .login-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 14px;
        }

        .login-form input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 12px;
            background: rgba(17, 24, 39, 0.25);
            color: var(--text-main);
            outline: none;
            transition: transform 0.22s ease, box-shadow 0.22s ease, border-color 0.22s ease;
            transform-origin: center;
        }

        .login-form input:hover {
            transform: scale(1.02);
        }

        .login-form input:focus {
            border-color: rgba(139, 92, 246, 0.65);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.18);
            transform: scale(1.02);
        }

        .login-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
        }

        .login-btn,
        .logout-btn {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            background: rgba(17, 24, 39, 0.35);
            color: rgba(249, 250, 251, 0.92);
            cursor: pointer;
            font-weight: 700;
            transition: transform 0.22s ease, box-shadow 0.22s ease;
            transform-origin: center;
        }

        .login-btn {
            border: none;
            background: linear-gradient(135deg, var(--primary-color), #7c3aed);
            box-shadow: 0 12px 18px -10px rgba(124, 58, 237, 0.55);
        }

        .login-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 16px 22px -12px rgba(124, 58, 237, 0.65);
        }

        .logout-btn {
            border: 1px solid rgba(239, 68, 68, 0.45);
            color: rgba(239, 68, 68, 0.95);
            background: rgba(239, 68, 68, 0.08);
        }

        .logout-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 12px 18px -12px rgba(239, 68, 68, 0.45);
        }

        .login-status {
            font-size: 0.92rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 9999px;
            background: rgba(107, 114, 128, 0.8);
            box-shadow: 0 0 0 4px rgba(107, 114, 128, 0.16);
        }

        .status-dot.ok {
            background: rgba(16, 185, 129, 0.95);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.18);
        }

        .status-dot.warn {
            background: rgba(245, 158, 11, 0.95);
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.18);
        }

        .upload-area:hover .upload-icon {
            transform: scale(1.1);
        }

        .upload-text {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .browse-button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 9999px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .browse-button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        #fileInput {
            display: none;
        }

        .file-info {
            margin: 24px 0;
            padding: 20px;
            background: var(--upload-area-bg);
            border-radius: 12px;
            display: none;
            border: 1px solid var(--border-color);
            text-align: left;
        }

        .file-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .file-name {
            font-weight: 600;
            color: var(--text-main);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 70%;
        }

        .file-size {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-family: monospace;
        }

        .progress-container {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
            display: none;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), #9333ea);
            width: 0%;
            transition: width 0.1s linear;
            border-radius: 4px;
        }

        .progress-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 6px;
            text-align: right;
            display: none;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .upload-action-btn {
            background: linear-gradient(135deg, var(--primary-color), #7c3aed);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            flex: 1;
            display: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .upload-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 20px -5px rgba(0, 0, 0, 0.15);
        }

        .cancel-btn {
            background: var(--surface-bg);
            color: var(--error-color);
            border: 1px solid var(--error-color);
            padding: 16px 32px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            flex: 1;
            display: none;
        }

        .cancel-btn:hover {
            background: var(--danger-bg);
        }

        .result-area {
            margin-top: 32px;
            padding: 24px;
            background: var(--result-bg);
            border: 1px solid var(--result-border);
            border-radius: 16px;
            display: none;
            text-align: left;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .success-header {
            display: flex;
            align-items: center;
            color: var(--success-color);
            font-weight: 700;
            margin-bottom: 16px;
            font-size: 1.1rem;
        }

        .success-icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }

        .share-link-container {
            background: var(--link-container-bg);
            border: 1px solid var(--link-container-border);
            border-radius: 12px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .share-link {
            color: var(--primary-color);
            text-decoration: none;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.95rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 12px;
        }

        .share-link:hover {
            text-decoration: underline;
        }

        .copy-btn-small {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .copy-btn-small:hover {
            background: var(--surface-hover);
            color: var(--text-main);
            border-color: var(--surface-border-hover);
        }

        .error-message {
            color: var(--error-color);
            background: var(--danger-bg);
            border: 1px solid var(--danger-border);
            padding: 16px;
            border-radius: 12px;
            margin: 24px 0;
            display: none;
            text-align: left;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .auth-error-message {
            color: var(--error-color);
            background: var(--danger-bg);
            border: 1px solid var(--danger-border);
            padding: 12px 14px;
            border-radius: 12px;
            margin: 0 0 12px;
            display: none;
            text-align: left;
            font-size: 0.92rem;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <!-- åˆ‡æ¢æŒ‰é’®ï¼šå›ºå®šåœ¨å³ä¸Šè§’ -->
    <button class="theme-toggle" id="themeToggle" title="åˆ‡æ¢ä¸»é¢˜">
        <!-- é»˜è®¤æ˜¾ç¤ºå¤ªé˜³å›¾æ ‡ -->
        <svg viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
    </button>

    <!-- ç™»å½•æŒ‰é’®ï¼šå›ºå®šåœ¨å³ä¸Šè§’ï¼ˆä¸å½±å“ä¸Šä¼  UIï¼‰ -->
    <button class="auth-toggle" id="authToggle" title="ç™»å½•/é€€å‡º">
        <svg viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
        </svg>
    </button>

    <div class="container">
        <div class="logo">ğŸ“ FileShare</div>
        <div class="subtitle">ç®€å•ã€å¿«é€Ÿã€å®‰å…¨çš„æ–‡ä»¶åˆ†äº«æœåŠ¡</div>

        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">â˜ï¸</div>
            <div class="upload-text">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®</div>
            <button class="browse-button" type="button">é€‰æ‹©æ–‡ä»¶</button>
            <input type="file" id="fileInput">
        </div>

        <div class="file-info" id="fileInfo">
            <div class="file-details">
                <div class="file-name" id="fileName"></div>
                <div class="file-size" id="fileSize"></div>
            </div>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <div class="btn-group">
            <button class="upload-action-btn" id="uploadButton" type="button">Start Upload</button>
            <button class="cancel-btn" id="cancelButton" type="button">Cancel</button>
        </div>

        <div class="result-area" id="resultArea">
            <div class="success-header">
                <span class="success-icon">âœ…</span> Upload Successful
            </div>
            <div style="margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">Share Link:</div>
            <div class="share-link-container">
                <a href="#" target="_blank" class="share-link" id="shareLink"></a>
                <button class="copy-btn-small" id="copyButton" type="button">Copy</button>
            </div>
        </div>
    </div>

    <!-- ç™»å½•å¼¹çª—ï¼ˆä¸æ»‘å¼¹å‡ºï¼Œä¸å ç”¨ä¸»å¡ç‰‡ç©ºé—´ï¼‰ -->
    <div class="auth-overlay" id="authOverlay" aria-hidden="true">
        <div class="auth-modal" role="dialog" aria-modal="true" aria-label="ç™»å½•">
            <div class="auth-modal-header">
                <div>
                    <div class="auth-modal-title">ç™»å½•åæ‰å¯ä¸Šä¼ </div>
                </div>
            </div>

            <div class="auth-body">
                <div class="login-area" style="margin: 0;">
                    <div class="login-form">
                        <input type="text" id="loginUser" placeholder="ç”¨æˆ·å" autocomplete="username">
                        <input type="password" id="loginPassword" placeholder="å¯†ç " autocomplete="current-password">
                    </div>
                    <div class="auth-error-message" id="authErrorMessage"></div>
                    <div class="login-actions">
                        <button class="login-btn" id="loginButton" type="button">ç™»å½•</button>
                        <button class="logout-btn" id="logoutButton" type="button">ç™»å‡º</button>
                    </div>
                    <div class="login-status" id="loginStatus"><span class="status-dot"></span><span>æœªç™»å½•</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const uploadButton = document.getElementById('uploadButton');
        const cancelButton = document.getElementById('cancelButton');
        const resultArea = document.getElementById('resultArea');
        const shareLink = document.getElementById('shareLink');
        const copyButton = document.getElementById('copyButton');
        const errorMessage = document.getElementById('errorMessage');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const themeToggle = document.getElementById('themeToggle');

        const loginUser = document.getElementById('loginUser');
        const loginPassword = document.getElementById('loginPassword');
        const loginButton = document.getElementById('loginButton');
        const logoutButton = document.getElementById('logoutButton');
        const loginStatus = document.getElementById('loginStatus');
        const authErrorMessage = document.getElementById('authErrorMessage');

        const authToggle = document.getElementById('authToggle');
        const authOverlay = document.getElementById('authOverlay');

        const THEME_STORAGE_KEY = 'fileshare.theme';
        const TOKEN_STORAGE_KEY = 'fileshare.token';

        let authEnabled = false;
        let loginMode = 'password'; // password | unavailable

        let selectedFile = null;
        let currentXhr = null;

        const MAX_UPLOAD_BYTES = 5 * 1024 * 1024 * 1024;

        // SVG å›¾æ ‡å®šä¹‰ï¼Œé¿å…å­—ç¬¦ç¼–ç é—®é¢˜
        const sunIcon = `<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`;
        const moonIcon = `<svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`;

        let isDarkMode = false;
        let isThemeTransitioning = false;

        function loadThemePreference() {
            // è¿”å› true/false æˆ– nullï¼ˆæ²¡æœ‰ä¿å­˜è¿‡ï¼‰
            try {
                const v = localStorage.getItem(THEME_STORAGE_KEY);
                if (v === 'dark') return true;
                if (v === 'light') return false;
            } catch (_) { }
            return null;
        }

        function hasSavedThemePreference() {
            return loadThemePreference() !== null;
        }

        function saveThemePreference(isDark) {
            try {
                localStorage.setItem(THEME_STORAGE_KEY, isDark ? 'dark' : 'light');
            } catch (_) { }
        }

        function getSystemPrefersDark() {
            try {
                return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            } catch (_) {
                return false;
            }
        }

        function getThemeBackgroundGradient(theme) {
            // ä»…ç”¨äºé®ç½©å±‚èƒŒæ™¯ï¼šç”¨å›ºå®šå€¼ä¿è¯åˆ‡æ¢è¿‡ç¨‹ä¸­ä¸å— CSS å˜é‡å˜åŒ–å½±å“
            if (theme === 'dark') {
                return 'linear-gradient(135deg, #667eea, #764ba2)';
            }
            return 'linear-gradient(135deg, #e0e7ff, #f3e8ff)';
        }

        function setTheme(nextIsDark, persist = true) {
            isDarkMode = nextIsDark;
            if (isDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = moonIcon;
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.innerHTML = sunIcon;
            }

            if (persist) {
                saveThemePreference(isDarkMode);
            }
        }

        function toggleThemeWithDiagonalReveal() {
            if (isThemeTransitioning) return;
            isThemeTransitioning = true;

            const prevTheme = isDarkMode ? 'dark' : 'light';
            const nextIsDark = !isDarkMode;

            // ç™½å¤© -> é»‘å¤œï¼šä»å³ä¸‹åˆ°å·¦ä¸Šï¼ˆèµ·ç‚¹åœ¨å³ä¸‹ï¼‰
            // é»‘å¤œ -> ç™½å¤©ï¼šä»å·¦ä¸Šåˆ°å³ä¸‹ï¼ˆèµ·ç‚¹åœ¨å·¦ä¸Šï¼‰
            const revealOrigin = (!isDarkMode && nextIsDark) ? '0% 0%' : '100% 100%';

            // å…ˆåˆ‡åˆ°æ–°ä¸»é¢˜ï¼Œå†ç”¨æ—§ä¸»é¢˜é®ç½©ä»æŒ‡å®šè§’è½æ”¶ç¼©ï¼Œéœ²å‡ºæ–°ä¸»é¢˜
            setTheme(nextIsDark);

            const layer = document.createElement('div');
            layer.className = 'theme-transition-layer';
            layer.style.background = getThemeBackgroundGradient(prevTheme);
            layer.style.clipPath = `circle(150vmax at ${revealOrigin})`;
            document.body.appendChild(layer);

            // ä¸‹ä¸€å¸§è§¦å‘ transition
            requestAnimationFrame(() => {
                layer.style.clipPath = `circle(0vmax at ${revealOrigin})`;
            });

            const cleanup = () => {
                layer.removeEventListener('transitionend', cleanup);
                if (layer.parentNode) layer.parentNode.removeChild(layer);
                isThemeTransitioning = false;
            };
            layer.addEventListener('transitionend', cleanup);

            // å…œåº•ï¼šæç«¯æƒ…å†µä¸‹ transitionend ä¸è§¦å‘
            setTimeout(cleanup, 1100);
        }

        themeToggle.addEventListener('click', toggleThemeWithDiagonalReveal);

        // åˆå§‹åŒ–ä¸»é¢˜ï¼šä¼˜å…ˆæœ¬åœ°ä¿å­˜ï¼Œå¦åˆ™è·Ÿéšç³»ç»Ÿä¸»é¢˜
        const saved = loadThemePreference();
        if (saved === null) {
            setTheme(getSystemPrefersDark(), false);

            // ä»…å½“â€œæœªæ‰‹åŠ¨é€‰æ‹©è¿‡ä¸»é¢˜â€æ—¶ï¼Œè·Ÿéšç³»ç»Ÿä¸»é¢˜å˜åŒ–
            try {
                const mq = window.matchMedia('(prefers-color-scheme: dark)');
                const onChange = (e) => {
                    if (!hasSavedThemePreference()) {
                        setTheme(!!e.matches, false);
                    }
                };
                if (mq && mq.addEventListener) {
                    mq.addEventListener('change', onChange);
                } else if (mq && mq.addListener) {
                    mq.addListener(onChange);
                }
            } catch (_) { }
        } else {
            setTheme(saved, false);
        }

        async function copyToClipboard(text) {
            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(text);
                    return true;
                }
            } catch (_) { }

            try {
                const ta = document.createElement('textarea');
                ta.value = text;
                ta.style.position = 'fixed';
                ta.style.left = '-9999px';
                document.body.appendChild(ta);
                ta.focus();
                ta.select();
                const ok = document.execCommand('copy');
                document.body.removeChild(ta);
                return ok;
            } catch (_) {
                return false;
            }
        }

        function resetUI() {
            resultArea.style.display = 'none';
            errorMessage.style.display = 'none';
            progressContainer.style.display = 'none';
            progressText.style.display = 'none';
            progressBar.style.width = '0%';
            progressText.textContent = '0%';

            uploadButton.style.display = 'block';
            uploadButton.textContent = 'Start Upload';

            cancelButton.style.display = 'none';

            updateAuthUI();
        }

        function showAuthError(msg) {
            authErrorMessage.textContent = msg;
            authErrorMessage.style.display = msg ? 'block' : 'none';
        }

        function clearAuthError() {
            showAuthError('');
        }

        function loadToken() {
            try {
                return localStorage.getItem(TOKEN_STORAGE_KEY) || '';
            } catch (_) {
                return '';
            }
        }

        function saveToken(token) {
            try {
                localStorage.setItem(TOKEN_STORAGE_KEY, token);
            } catch (_) { }
        }

        function clearToken() {
            try {
                localStorage.removeItem(TOKEN_STORAGE_KEY);
            } catch (_) { }
        }

        function updateAuthUI() {
            const token = loadToken();
            const hasToken = !!token;
            const canUpload = authEnabled ? hasToken : true;

            const dotClass = !authEnabled ? 'status-dot' : hasToken ? 'status-dot ok' : (loginMode === 'unavailable') ? 'status-dot warn' : 'status-dot';
            let text = '';
            if (!authEnabled) {
                text = 'æœªå¯ç”¨ç™»å½•';
            } else if (hasToken) {
                text = 'å·²ç™»å½•';
            } else {
                if (loginMode === 'unavailable') {
                    text = 'ç™»å½•ä¸å¯ç”¨ï¼šæ— æ³•æ£€æŸ¥æœåŠ¡ç«¯çŠ¶æ€';
                } else {
                    text = 'æœªç™»å½•';
                }
            }
            loginStatus.innerHTML = `<span class="${dotClass}"></span><span>${text}</span>`;

            // UI å§‹ç»ˆä¿ç•™ï¼šå³ä½¿æœªå¯ç”¨ç™»å½•ï¼Œä¹Ÿå…è®¸ç”¨æˆ·å°è¯•ç‚¹å‡»ç™»å½•ï¼ˆæœåŠ¡ç«¯ä¼šè¿”å› 404 å¹¶æç¤ºï¼‰ã€‚
            loginButton.disabled = loginMode === 'unavailable' || hasToken;
            // â€œé€€å‡ºâ€æŒ‰é’®åŒæ—¶ä½œä¸ºâ€œå…³é—­å¼¹çª—â€å…¥å£ï¼šæ— è®ºæ˜¯å¦å·²ç™»å½•éƒ½åº”è¯¥å¯ç‚¹
            logoutButton.disabled = false;
            uploadArea.classList.toggle('disabled', !canUpload);
            uploadButton.disabled = !canUpload;
        }

        function showAuthModal() {
            clearAuthError();
            authOverlay.classList.add('show');
            authOverlay.setAttribute('aria-hidden', 'false');
        }

        function hideAuthModal() {
            authOverlay.classList.remove('show');
            authOverlay.setAttribute('aria-hidden', 'true');
        }

        authToggle.addEventListener('click', () => {
            showAuthModal();
        });

        authOverlay.addEventListener('click', (e) => {
            if (e.target === authOverlay) hideAuthModal();
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') hideAuthModal();
        });

        // ä¸å†é€šè¿‡ /auth/status ä¸»åŠ¨æ¢æµ‹æœåŠ¡ç«¯æ˜¯å¦å¯ç”¨ç™»å½•ã€‚
        // ç°åœ¨æ”¹ä¸ºï¼šé»˜è®¤è®¤ä¸ºæœªå¯ç”¨ç™»å½•ï¼ˆä¸Šä¼ å¯ç”¨ï¼‰ï¼›å½“ä¸Šä¼ è¿”å› 401 æ—¶å†æç¤ºç”¨æˆ·ç™»å½•ã€‚

        uploadArea.addEventListener('click', () => {
            if (uploadArea.classList.contains('disabled')) {
                showError('Please Log in First');
                return;
            }
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) handleFileSelect(e.target.files[0]);
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) handleFileSelect(e.dataTransfer.files[0]);
        });

        function handleFileSelect(file) {
            resetUI();
            if (file.size > MAX_UPLOAD_BYTES) {
                showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 5GB');
                return;
            }

            selectedFile = file;
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            fileInfo.style.display = 'block';
            uploadButton.style.display = 'block';
        }

        uploadButton.addEventListener('click', () => {
            if (!selectedFile) return;
            const token = loadToken();
            if (authEnabled && !token) {
                showError('Please Log in First');
                return;
            }

            resetUI();
            fileInfo.style.display = 'block';
            progressContainer.style.display = 'block';
            progressText.style.display = 'block';

            uploadButton.disabled = true;
            uploadButton.textContent = 'Uploading...';
            uploadButton.style.display = 'none';
            cancelButton.style.display = 'block';

            currentXhr = new XMLHttpRequest();
            currentXhr.open('POST', '/upload', true);

            currentXhr.setRequestHeader('X-File-Name', encodeURIComponent(selectedFile.name));
            currentXhr.setRequestHeader('Content-Type', selectedFile.type || 'application/octet-stream');
            if (authEnabled && token) {
                currentXhr.setRequestHeader('X-Auth-Token', token);
            }

            currentXhr.upload.onprogress = (e) => {
                if (e.lengthComputable) {
                    const percent = Math.round((e.loaded / e.total) * 100);
                    progressBar.style.width = percent + '%';
                    progressText.textContent = percent + '%';
                }
            };

            currentXhr.onload = () => {
                if (currentXhr.status >= 200 && currentXhr.status < 300) {
                    try {
                        const result = JSON.parse(currentXhr.responseText);
                        if (result && result.url) {
                            showSuccess(result.url);
                        } else {
                            throw new Error('è¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
                        }
                    } catch (e) {
                        showError('è§£æå“åº”å¤±è´¥: ' + e.message);
                    }
                } else {
                    if (currentXhr.status === 401) {
                        authEnabled = true;
                        loginMode = 'password';
                        updateAuthUI();
                        showError('Please Log in First');
                        finishUpload();
                        return;
                    }
                    showError(`Upload failed (${currentXhr.status}): ${currentXhr.responseText}`);
                }
                finishUpload();
            };

            currentXhr.onerror = () => {
                showError('Network error, please check your network');
                finishUpload();
            };

            currentXhr.onabort = () => {
                showError('Upload cancelled');
                finishUpload();
            };

            currentXhr.send(selectedFile);
        });

        cancelButton.addEventListener('click', () => {
            if (currentXhr) {
                currentXhr.abort();
                currentXhr = null;
            }
        });

        function finishUpload() {
            currentXhr = null;
            uploadButton.textContent = 'Start Upload';
            uploadButton.disabled = false;
            uploadButton.style.display = 'block';
            cancelButton.style.display = 'none';
        }

        loginButton.addEventListener('click', () => {
            const user = loginUser.value.trim();
            const pwd = loginPassword.value.trim();
            if (!user || !pwd) {
                showAuthError('Please enter username and password');
                return;
            }

            if (loginMode === 'unavailable') {
                showAuthError('Login unavailable: server status check failed');
                return;
            }

            (async () => {
                try {
                    loginButton.disabled = true;

                    const resp = await fetch('/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ user, password: pwd })
                    });

                    if (resp.status === 404) {
                        authEnabled = false;
                        updateAuthUI();
                        throw new Error('Login not enabled on server');
                    }

                    if (!resp.ok) {
                        const t = await resp.text().catch(() => '');
                        throw new Error(t || ('HTTP ' + resp.status));
                    }

                    const result = await resp.json();
                    if (result && result.token) {
                        authEnabled = true;
                        saveToken(result.token);
                        updateAuthUI();
                        clearAuthError();
                        hideAuthModal();
                        return;
                    }
                    throw new Error('Login response format error');
                } catch (e) {
                    showAuthError('Login failed: ' + (e && e.message ? e.message : String(e)));
                } finally {
                    loginButton.disabled = false;
                }
            })();
        });

        logoutButton.addEventListener('click', () => {
            // å§‹ç»ˆå…³é—­å¼¹çª—ï¼›å¦‚æœå·²ç™»å½•åˆ™é¡ºä¾¿é€€å‡ºç™»å½•ï¼ˆæ¸…é™¤æœ¬åœ° tokenï¼‰
            const token = loadToken();
            if (token) clearToken();
            updateAuthUI();
            hideAuthModal();
        });

        copyButton.addEventListener('click', () => {
            const link = shareLink.href;
            copyToClipboard(link).then((ok) => {
                const originalText = copyButton.textContent;
                copyButton.textContent = ok ? 'å·²å¤åˆ¶' : 'å¤åˆ¶å¤±è´¥';
                setTimeout(() => copyButton.textContent = originalText, 1500);
            });
        });

        function showSuccess(url) {
            shareLink.href = url;
            shareLink.textContent = url;
            resultArea.style.display = 'block';
            uploadButton.style.display = 'none';
            cancelButton.style.display = 'none';
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.style.display = msg ? 'block' : 'none';
            progressContainer.style.display = 'none';
            progressText.style.display = 'none';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        updateAuthUI();
    </script>
</body>

</html>