# nginx configuration file

server {
  listen 80 default_server; # 设置为默认服务器
  server_name _;

  location / {
    proxy_pass http://0.0.0.0:8080; # # --network host 模式下，0.0.0.0 指的是主机本机（容器内的 0.0.0.0、127.0.0.1 和主机的 0.0.0.0、127.0.0.1 是相同的）
    # proxy_http_version 1.1; # 使用 HTTP/1.1 以支持持久连接
    # proxy_set_header Connection ""; # 清除 Connection 头以启用持久连接
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  }
}

# ====================================================================

# 已看到你后端监听 0.0.0.0:8080。现在 Nginx 能启动但未反代，多半是命中到了镜像自带的默认站点 default.conf（或非默认 server 抢不到匹配）。
# 我已更新 forward_host.conf 为默认 server，并新增 empty.conf 用来覆盖默认站点。

# 推荐：使用 host 网络（前提：主机 80 端口空闲）
# sudo docker run -d --name nginx-forward \
#   --network host \
#   -v $(pwd)/forward_host.conf:/etc/nginx/conf.d/forward.conf:ro \
#   -v $(pwd)/empty.conf:/etc/nginx/conf.d/default.conf:ro \
#   nginx:trixie-perl
#
# 若容器立即退出，请先检查：
#   1) 主机 80 端口是否被占用：sudo ss -ltnp | grep ':80 ' （其他容器正在占用）
#   2) 查看容器日志：sudo docker logs nginx-forward
# 常见错误：bind() 80 address already in use（说明主机 80 被占用）
# ====================================================================
